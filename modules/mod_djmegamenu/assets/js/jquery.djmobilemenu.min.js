var DJMegaMobile;(function(e){DJMegaMobile=function(){this.mega=[],this.timer=null,this.init()},DJMegaMobile.prototype.init=function(){var a=this;e(".dj-megamenu:not(.dj-megamenu-sticky)").each(function(){var n=e(this),o=e("#"+n.prop("id")+"mobile"),t=e("#"+n.prop("id")+"offcanvas"),i=a.mega.length;a.mega[i]={},a.mega[i].id=n.prop("id"),a.mega[i].trigger=n.data("trigger"),a.mega[i].menu=n,a.mega[i].menuHandler=e("<div />"),a.mega[i].mobile=o.length?o:null,a.mega[i].mobileHandler=e("<div />"),a.mega[i].offcanvas=t.length?t:null,a.mega[i].offcanvasHandler=e("<div />");var d=e("#"+n.prop("id")+"mobileWrap");d.length&&d.empty().append(a.mega[i].mobile),a.mega[i].mobile&&(a.mega[i].mobile.find(".dj-hideitem").remove(),a.mega[i].mobile.hasClass("dj-megamenu-offcanvas")?a.createOffcanvas(a.mega[i].mobile):a.mega[i].mobile.hasClass("dj-megamenu-accordion")&&a.createAccordion(a.mega[i].mobile),a.mega[i].mobile.parents(".nav-collapse").addClass("collapse in").css("height","auto").prev(".navbar").remove(),a.mega[i].mobile.parents(".navbar-collapse").addClass("show").prev(".navbar-toggler").remove())}),e(window).resize(a.switchMenu.bind(a)),a.switchMenu(),e(document).on("click",".dj-offcanvas-open",function(a){e(a.target).parents(".dj-offcanvas").length||e(a.target).hasClass("dj-offcanvas")||e(".dj-offcanvas-opened").find(".dj-offcanvas-close-btn").click()}),e(document).on("djmegamobile:pageload",function(){for(var e=0;e<a.mega.length;e++)a.mega[e].mobile&&a.mega[e].mobile.hasClass("dj-megamenu-select")&&a.createSelectMenu(a.mega[e].menu,a.mega[e].mobile)})},DJMegaMobile.prototype.createSelectMenu=function(a,n){var o=a.attr("id"),t=n.attr("data-label")||"menu",i=n.find(".dj-mobile-open-btn"),d=e('<select id="'+o+'select" class="inputbox dj-select" />');d.on("click blur",function(){i.toggleClass("active")}),d.on("change",function(){i.removeClass("active"),e(this).val&&(window.location=e(this).val())});var s=e('<label class="hidden" aria-hidden="true" for="'+o+'select">'+t+"</label>"),l=a.find("li.dj-up");this.addOptionsFromDJMegaMenu(l,d,0),s.appendTo(n),d.appendTo(n),i.on("click",function(e){e.stopPropagation(),e.preventDefault();var a=d[0];if(document.createEvent){var n=document.createEvent("MouseEvents");n.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(n)}else a.fireEvent&&a.fireEvent("onmousedown")})},DJMegaMobile.prototype.addOptionsFromDJMegaMenu=function(a,n,o){for(var t=this,i="",d=!1,s=0;s<o;s++)i+="- ";a.each(function(){var a=e(this),s=a.find("> a").first(),l=a.find("> .dj-subwrap > .dj-subwrap-in > .dj-subcol > .dj-submenu > li, > .dj-subtree > li");if(s.length){var c="",r=s.find("img").first();r.length?c=i+r.attr("alt"):(c=s.html().replace(/(<small[^<]+<\/small>)/gi,""),c=i+c.replace(/(<([^>]+)>)/gi,""));var m=e('<option value="'+s.prop("href")+'">'+c+"</option>").appendTo(n);s.prop("href")||m.prop("disabled",!0),a.hasClass("active")&&(n.val(m.val()),d=!0)}l&&t.addOptionsFromDJMegaMenu(l,n,o+1)}),o||d||n.val("")},DJMegaMobile.prototype.initAccordion=function(a){var n=null,o=a.find(".dj-offcanvas-close-btn");a.find("ul.dj-mobile-nav > li, ul.dj-mobile-nav-child > li").each(function(){var t=e(this),i=t.find("> a").first();if(i.length){var d=t.find("> ul.dj-mobile-nav-child > li:not(:empty)");d.length||(t.removeClass("parent"),t.find("ul.dj-mobile-nav-child").remove()),t.hasClass("parent")&&(t.hasClass("active")?(i.attr("aria-expanded",!0),t.find("> ul").slideDown(400)):i.attr("aria-expanded",!1),i.append('<span class="toggler"></span>')),i.on("click",function(a){var i=e(this),d=e(a.target).hasClass("toggler"),s=i.attr("href"),l=null!=s&&s.length>1&&-1!==s.indexOf("#");clearTimeout(n),l&&!d&&a.which?(e(document.body).addClass("dj-offcanvas-no-effects"),o.click()):t.hasClass("parent")&&!t.hasClass("active")?a.preventDefault():d&&(a.preventDefault(),a.stopPropagation(),t.removeClass("active").find("> ul").slideUp(400),i.attr("aria-expanded",!1))}),i.on("focus",function(){var o=e(this);a.find("[aria-expanded]").attr("aria-expanded",!1),o.parents(".active").find("> [aria-expanded]").attr("aria-expanded",!0),o.attr("aria-expanded",!0),n=setTimeout(function(){t.click()},250)})}t.on("click",function(e){t.siblings().removeClass("active").find("> ul").slideUp(400),t.addClass("active").find("> ul").slideDown(400)})})},DJMegaMobile.prototype.createOffcanvas=function(a){a.parents("[data-joomla4]").length;var n=a.parents("[data-tmpl]").attr("data-tmpl"),o="cassiopeia"===n,t=null,i=e(".dj-offcanvas-wrapper").first(),d=e(".dj-offcanvas-pusher").first(),s=e(".dj-offcanvas-pusher-in").first();i.length||(t=e(document.body).children(),i=e('<div class="dj-offcanvas-wrapper" />'),d=e('<div class="dj-offcanvas-pusher" />'),s=e('<div class="dj-offcanvas-pusher-in" />'));var l=e(".dj-offcanvas"),c=a.find(".dj-offcanvas").first(),r=o||!i.length||l.length>1?"1":c.data("effect"),m=1==r;e(document.body).addClass("dj-megamenu-offcanvas dj-offcanvas-effect-"+r),m?e(document.body).append(c):(t&&e(document.body).prepend(i),3==r||6==r||7==r||8==r||14==r?d.append(c):i.append(c),t&&(i.append(d),d.append(s),s.append(t))),l.hide();var f=null,u=a.find(".dj-mobile-open-btn"),p=c.find(".dj-offcanvas-close-btn"),v=c.find('button, a, input:not([type="hidden"]), select, textarea, [tabindex]:not([tabindex="-1"])').last();u.on("click",function(a){a.stopPropagation(),a.preventDefault(),e(document.body).hasClass("dj-offcanvas-open")?(u.removeClass("active"),p.click()):(u.addClass("active"),clearTimeout(f),c.data("scroll",e(window).scrollTop()),e(document.body).addClass("dj-offcanvas-anim").removeClass("dj-offcanvas-no-effects"),setTimeout(function(){e(document.body).addClass("dj-offcanvas-open")},50),m||s.css("top",-c.data("scroll")),l.hide(),c.show(),c.removeAttr("aria-hidden"),c.attr("role","dialog"),c.attr("aria-modal","true"),c.addClass("dj-offcanvas-opened"),e(".dj-megamenu-offcanvas-overlay").length||c.parent().append('<div class="dj-megamenu-offcanvas-overlay" />'),setTimeout(function(){p.focus()},250))}),p.on("click",function(a){a.stopPropagation(),a.preventDefault(),e(document.body).hasClass("dj-offcanvas-open")&&(u.removeClass("active"),e(document.body).removeClass("dj-offcanvas-open"),e(document.body).hasClass("dj-offcanvas-no-effects")?(m||s.css("top",0),e(document.body).removeClass("dj-offcanvas-anim dj-offcanvas-no-effects"),c.hide(),u.focus()):f=setTimeout(function(){m||s.css("top",0),e(document.body).removeClass("dj-offcanvas-anim"),e(window).scrollTop(e(window).scrollTop()+c.data("scroll")),c.hide(),u.focus()},250),c.attr("aria-hidden","true"),c.removeAttr("role"),c.removeAttr("aria-modal"),c.removeClass("dj-offcanvas-opened"),e(document.body).find(".dj-megamenu-offcanvas-overlay").remove())}),p.on("keydown",function(e){"Tab"==e.key&&e.shiftKey&&(e.preventDefault(),v.focus())}),v.on("keydown",function(e){"Tab"!=e.key||e.shiftKey||(e.preventDefault(),p.focus())}),c.on("keydown",function(e){"Escape"===e.key&&p.click()}),this.initAccordion(c)},DJMegaMobile.prototype.createAccordion=function(a){var n=a.find(".dj-mobile-open-btn");n.on("click",function(n){n.stopPropagation(),n.preventDefault(),e(this).toggleClass("active"),a.find(".dj-accordion-in").slideToggle("fast")}),e(document).on("click",function(o){e(o.target).closest(".dj-accordion-in").length||(n.removeClass("active"),a.find(".dj-accordion-in").is(":visible")&&a.find(".dj-accordion-in").slideUp("fast"))}),this.initAccordion(a)},DJMegaMobile.prototype.switchMenu=function(){var a=this;window.clearTimeout(a.timer),a.timer=window.setTimeout(function(){for(var n=0;n<a.mega.length;n++)a.mega[n].mobile&&(window.matchMedia("(max-width: "+a.mega[n].trigger+"px)").matches?(e(document.body).addClass("dj-megamenu-mobile"),e(document.body).addClass(a.mega[n].id+"-mobile"),e.contains(document,a.mega[n].menu[0])&&(a.mega[n].menu.after(a.mega[n].menuHandler),a.mega[n].menu.detach()),e.contains(document,a.mega[n].mobileHandler[0])&&a.mega[n].mobileHandler.replaceWith(a.mega[n].mobile),e.contains(document,a.mega[n].offcanvasHandler[0])&&a.mega[n].offcanvasHandler.replaceWith(a.mega[n].offcanvas)):(e(document.body).removeClass("dj-megamenu-mobile dj-offcanvas-open dj-offcanvas-anim"),e(document.body).removeClass(a.mega[n].id+"-mobile"),e.contains(document,a.mega[n].mobile[0])&&(a.mega[n].mobile.after(a.mega[n].mobileHandler),a.mega[n].mobile.detach()),a.mega[n].offcanvas&&e.contains(document,a.mega[n].offcanvas[0])&&(a.mega[n].offcanvas.after(a.mega[n].offcanvasHandler),a.mega[n].offcanvas.detach()),e.contains(document,a.mega[n].menuHandler[0])&&a.mega[n].menuHandler.replaceWith(a.mega[n].menu)))},100)}})(jQuery);var initMobile=function(){"undefined"==typeof jQuery?console.log("DJ-Megamenu: jQuery missing"):new DJMegaMobile};"loading"!==document.readyState?initMobile():document.addEventListener("DOMContentLoaded",function(){initMobile()}),window.addEventListener("load",function(){"undefined"==typeof jQuery?console.log("DJ-Megamenu: jQuery missing"):jQuery(document).trigger("djmegamobile:pageload")});